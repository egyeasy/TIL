# 190621 블록체인의 요소 기술과 비즈니스 사례

## 1. 블록체인의 시작

#### 비트코인은 탈중앙화된 화폐

- 실물화폐는 중앙 기관에서 발행하고 금융 기관에서 관리함
- 비트코인은 별도의 발행 기관과 관리 기관이 없음



#### 탈중앙화는 많은 지불 결제의 중개에 드는 비용을 줄일 수 있음

- 금융기관이 없이도 송금이 가능함



#### 블록체인의 역사

#### 사이버 펑크 운동

1983 D.Chaum(암호학의 대부) : 신용카드의 사용은 프라이버시로부터 안전하지 못하다. 따라서 프라이버시를 지키기 위한 전자 화폐 시스템이 필요하다. 이를 위한 은닉 서명 암호 시스템을 제안한다.

1991 S.Haber and W. S. Stornetta : 디지털 데이터의 위변조를 마기 위해 해시와 타임스탬프를 이용하여 변경을 감지하자.

1992 D.Bayer, S.Haber : 문서를 트리화하여 저장

#### 스마트 계약

1997? 스마트 계약

1998 W.Dai "B Money" : 무정부주의 경제 신봉

#### 작업 증명과 Bit Gold

2008 N.Szabo : 작업 증명

#### 비트코인의 등장

2008 S.Nakamoto : 비트코인 백서



#### Mt.Gox 사고(2011.6.13)

암호화폐 해킹 사건 - 내부 직원이 빼돌림. 탈중앙화된 시스템이지만 중앙화된 거래 시스템.





## 2. 블록체인과 네트워크

#### 비트코인의 거래

비트코인은 탈중앙화된 장부로 이루어짐

- 참여자가 모든 사람의 거래내역을 저장함: 분산화
- 참여자가 합의하여 거래를 결정: 분권화



#### Peer-to-peer 네트워크

블록체인은 P2P 네트워크를 통해 거래를 저장함

- 클라이언트/서버는 계층을 두고 데이터를 전송함
- P2P는 동등 계층 간의 데이터를 전송하는 기법을 말함
- 피어들은 서버와 클라이언트의 역할을 동시에 함



#### 정의 1. 블록체인의 불가역성

한번 기록/승인된 데이터는 수정과 삭제가 불가능하여야 한다.





## 3. 블록체인과 디지털 서명

#### 비트코인의 부인방지

- 다른 사람이 자신의 돈을 보낼 수 없어야 함.
- 내가 보냈다는 사실을 추후에 부인할 수 없어야 함.

=> 보낸 사람의 디지털 서명 기록을 근거로 부인 방지



#### 비트코인의 지갑

- 공개키 기반 구조(PKI)
- **개인키/공개키가 비대칭 키로서 활용됨** -> 공개키로 암호화를 하면 개인키로만 복호화 가능. 개인키로 암호화를 하면 공개키로만 복호화 가능.

개인키를 통해 공개키 생성(역은 불가)

공개키를 통해 비트코인 주소 생성(역은 불가)



#### 비트코인의 디지털 서명

T : Alice to Bob; 1BTC

-> 암호화(Alice)

->

Alice의 공개키로 해독이 되는 걸 보니 Alice의 개인키로 암호화된 것 -> Alice가 보낸 것이 맞다.



#### 정의 2. 데이터 출처 검증

데이터 저장 시 데이터의 출처를 기록하여야 한다.





## 4. 블록 생성과 작업 증명

거래들이 기록된 블록들이 Linked List로 연결되어 있다.



#### 해시 알고리즘

- 주로 원본 값의 위변조 여부를 확인하는 데 활용함
- 출력값으로 입력값을 유추할 수 없음



#### 블록의 구성

Block Body에는 10분 간 생성된 트랜잭션들이 기록되어 있다.

Block Header에는 다음 6가지 요소가 포함되어 있다.

- 이전 블록의 해시코드(식별 번호)
- 트랜잭션의 해시코드(Merkle Root)
- 블록 생성 시간
- 문제 난이도
- 문제 정답(Nonce)



#### 트랜잭션의 해시 저장 : 머클트리

10분 간의 거래들을 leaf node로 구성하고, 최하단 transaction들의 해시값을 합쳐서 위로 올라가며 부모 노드들을 구성 -> 최상단 root에는 모든 leaf node(거래)의 데이터를 해시화한 값이 저장됨.



#### 정의 3.  모두가 검증 가능한 데이터 저장소

참여자 모두가 데이터 무결성을 확인할 수 있어야 한다.



#### 비트코인 채굴하기

#### 작업증명(Proof of Work)

"해시 코드를 000z보다 작은 추가 값을 찾으시오"

"Hello world!4250" => 0000c3af4.....

=> 정답을 찾아냄 : 4250(=nonce)



#### 난이도 조절

- 매 2016 블록시 마다 난이도를 재계산
- 최대 난이도는 2^224
- nonce는 헤더의 해시가 current_target보다 낮은 경우 성립



#### 비트코인과 보상

매 4년마다 보상이 반감 -> 2100만 개가 최대 발행량

현재 12.5개 보상



#### 작업증명의 한계

높아지는 전력량

- 초당 150~900MW
- 350MW 기준 미국 가정 28만 호의 소모량

- 매년 50억 달러의 전력 비용
- 15분 비트코인 전력 = 소양강 댐 1년 발전량





## 5. 비트코인 이중 지불 방지와 합의

#### 이중 지불의 사례

- 이중 지불은 지불이 완전히 승인이 나기 전에 다른 지불을 진행하는 것을 의미함
- 비트코인은 승인에 시간이 걸리기 때문에 이중 지불이 가능함



#### 6승인과 포크

포크 : 이중 지불을 하면 블록의 분기가 발생함

6승인 : 블록의 완전 승인은 6개의 블록이 더 생성되어야 함 -> 1시간 소요

포크 시 블록 승인 : 먼저 6승인을 성공한 블록이 완전 승인됨



일반 노드들은 승인 확률이 높은 블록을 기반으로 블록을 생성함(Longest Path 법칙)

따라서 길이가 길거나 블록 시간이 빠른 쪽에 먼저 블록을 만듦



#### 51% 공격

- 이중 지불의 성공을 위해서는 전체 해시 파워의 51% 이상을 한 시간 동안 장악해야 함
- 이는 현실적으로 매우 어려움



#### 합의의 이미

블록체인 노드 : "우리는 합의를 통해서 모든 장부를 동기화 해야 하지"



#### 정의 4. 합의된 데이터 저장

모든 참여자가 합의를 이룬 데이터를 저장하여야 한다.



### 정리 : 블록체인 데이터가 신뢰받는 이유

1. 한번 기록/승인된 데이터는 수정과 삭제가 불가능하여야 한다.
2. 데이터 저장 시 데이터의 출처를 기록해야 한다.
3. 참여자 보유 데이터의 무결성을 검증할 수 있어야 한다.
4. 모든 참여자가 합의를 이룬 데이터를 저장하여야 한다.



- p2p network 
- public key infrastructure
- hash algorithm
- consensus





## 6. 이더리움 - 스마트 컨트랙트의 개요

#### 이더리움의 등장

이더리움 서비스 -> 네트워크 상에서 스마트 컨트랙트를 가능하게 함

비탈릭 부테린 : 게임하다가 캐릭터 너프받고 중앙통제식 시스템에 빡침 -> Bitcoin 커뮤니티에 제안했다가 거절 당함 -> 이더리움 만듦



#### 스마트 컨트랙트의 기원(Nick Szabo, 1994)

- 특정 계약을 스스로 수립, 검증, 이행하기 위한 컴퓨터 프로토콜
- 계약의 보안을 높이기 위한 방안
- 계약 비용을 감소하기 위한 방안

but 스마트 컨트랙트를 누가 쓰고, 누군가 수정하면 어떡함?



비탈릭 부테린 : 블록체인에 스마트 컨트랙트 데이터를 기록하겠다 -> 계약 내용, 코드와 함께 이행 이력과 결과까지 포함



#### 프로그래머블 머니

내기를 하고, 특정한 돈이 매달 1일 누군가에게 1/5씩 다섯 달 동안 송금된다는 계약

-> 이 돈은 특정 검증된 프로그램에 따라 지불됨.

공증기관이 없이도 강제할 수 있다는 것이 이론적 가능성

but 현실적 문제 -> 내기 경기의 결과 데이터가 옳다는 것을 어떻게 검증할지?(오라클 problem)



#### 블록체인 2.0

1세대인 블록체인은 송금밖에 못함

2세대 이더리움에서는 computational engine, decentralize database, development API, smart contract 포함



#### 스마트 컨트랙트 활용 사례

- 토큰 서비스(ERC20) - 이더리움 안에서 스마트 컨트랙트를 만들고 그 에코시스템 안에서 토큰(= ERC20)으로 거래한다. but 부작용 : 허무맹랑한 백서를 만들어서 토큰을 모으고 도주. 많은 스타트업들이 토큰을 모으지만 서비스에는 충실하지 않는다.
- 에스크로 서비스 - 옥션, 지마켓과 같은 중개 서비스

cf. 백서 - 마케팅 페이퍼 / yellow paper - 기술적인 페이퍼



#### 이더리움 가상 머신

- 모든 소프트웨어는 운영체제에 맞게 컴파일되고 실행되어야 함

- 자바 가상 머신
  - 운영체제의 시스템 콜을 직접 호출하지 않고, JVM에서 처리
  - 실행되는 운영체제에 관계없이 자바 코드를 실행함
- 이더리움 가상 머신
  - 이더리움 스마트 컨트랙트 코드를 실행
  - 모든 트랜잭션이 공유되고 동기화됨



#### 스마트 컨트랙트 배포 및 실행

**스마트 계약 생성 과정**

스마트 계약 코드 -> 바이트 코드 -> 블록체인 블록 -> 블록체인 네트워크

**스마트 계약 실행 과정**

사용자 주소 + 함수 주소 + 매개 변수 -> 블록체인 블록 -> 블록체인 네트워크



#### 튜링 완전성과 가스

cf. 비트코인은 스크립트 안에 루프문이 없음 -> Ddos 공격 방지(무한루프 공격)

이더리움에서는 튜링 완전성을 위해 루프문 도입

- 스마트 계약을 실행하기 위한 수수료

  수수료 = 가스가격(Gas Price) x 사용 가스 수

  단위 가스가격은 사용자가 정의할 수 있으나, 많을수록 빠른 처리가 가능함

  모든 계약에 가스 제한(Gas Limit)을 둘 수 있음

- 호출하는 함수의 종류에 따라 비용 차등 부여





## 7. 기업형 블록체인 비즈니스의 사례

#### R3CEV의 탄생

R3CEV는 스타트업 -> 현재 공룡 스타트업

1차 회의 : 2014년 9월 23일 뉴욕에서 벤처 투자자와 8명의 은행 대표가 암호화폐를 금융에 적용하기 위한 회의를 진행함



#### 사례 발굴

- 은행 간 거래에 중앙화를 없애고 블록체인 방식을 활용함
- 중앙화(swift - 은행 간 국제 송금 수수료가 어마어마함)에서 오는 중개비용과 해킹의 위험성을 낮춤



#### R3의 흥행

private blockchain -> 전 세계 수십 개의 은행들이 가입



#### 공개형 블록체인의 한계

- 프라이버시(Privacy)

- 트랜잭션 최종성(Transaction Finality)

  현재의 블록체인은 트랜잭션을 결정하는 데 시간이 소요됨.

- 식별 가능한 참여자(Identifiable Participants)

  비즈니스에서는 상대방이 누궁니지 식별할 수 있어야 함(KYC, Know Your Customer)

- 확장성(Scalability)

  하루에 10억 개의 트랜잭션을 처리할 수 있어야 함.

  비트코인에서는 참여자가 많아질수록 난이도가 높아진다, 전력낭비 up(PoW)

  빠른 속도가 생명인 금융거래에서 이러한 확장성의 한계는 큰 문제

- 생산성과 통합(Productivity and Integration)

  다량의 데이터 처리 가능해야

  기존의 시스템과 통합할 수 있어야



#### Corda의 아키텍처

- 허가의 네트워크
- P2P(Point-to-Point) - 거리 당사자들끼리만 정보 공유



#### 공개형과 허가형의 차이

|                     | Public                        | Private                      |
| ------------------- | ----------------------------- | ---------------------------- |
| Participant         | Anyone                        | Authorized                   |
| Data Access         | Any participant               | Permissioned read and write  |
| Throughput          | Slower                        | Faster                       |
| Block Gen./Val.     | Proof of work, Proof of stake | Agreed method                |
| Asset(수수료, 통화) | Native(e.g. gas)              | Any(e.g. 실제 돈, 그냥 숫자) |



#### 비즈니스 블록체인 개발 연합

the Linux Foundation에서 Hyperledger 프로젝트

private blockchain 구성 가능. 오픈소스화하여 공개

하이퍼렛저 회원사 - 굉장히 많은 세계 기업들이 들어와있다. 연간 멤버십 비용 지불



cf. 샤딩 - 노드를 줄여서 데이터 저장?



#### 하이퍼렛저의 프로젝트들(툴 & 프레임워크)

가장 큰 것이 hyperledger FABRIC project - 엔터프라이즈 블록체인에 최적인 것으로 유명.



#### 패브릭의 적용 사례

월마트, IBM, HSBC, ...



#### 월마트 & IBM

- 돼지의 탄생부터 식탁 앞에 오기까지의 이력을 담자!
- 식품 안전성 확보 차원
- 사료, 농장, 도축, 운반, 판매, 보관을 모두 기록
- 월마트, IBM, 칭화대학교 참여
- 돼지고기와 망고로 시범사업 진행 중



#### 머스크

- Trade Lens라는 플랫폼 개발
- 운송에 드는 수많은 정보를 관리 -> 이전까지 수기로 하던 작업을 디지털화
- 안전한 정보 교환
- 조작이 불가능한 저장소
- 운송 지연과 불법 거래를 방지함 -> 암암리에 불법으로 처리되던 것을 감시
- 투명한 무역 거래로 인한 무역 활성화 효과 기대
- 현재까지 약 5억 건의 물류를 처리함

but, 위법 행위 사실 관계의 파악 등 문제는 어떻게 할 것인가? (side chain, off chain의 문제)



#### 기업형 블록체인의 활용 가능 사업 분야

- 의료가 유망함 : 이 병원에서 CT 찍었는데 저 병원 가서 또 CT 찍어야 하는 문제, 개인 데이터를 기업들이 활용할 때 돈을 내도록 시스템화(private blockchain)